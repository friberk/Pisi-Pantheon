From: Berk Cakar <berk2238@hotmail.com>
Date: Fri, 23 Jul 2021 19:45:29 +0300
Subject: [PATCH] Added eOS 6 dark mode support

---
 meson.build          |  1 +
 src/Application.vala | 10 ++++++++++
 2 files changed, 11 insertions(+)

diff --git a/meson.build b/meson.build
index 64c627f..c000310 100644
--- a/meson.build
+++ b/meson.build
@@ -88,6 +88,7 @@ executable(
         dependency('glib-2.0'),
         dependency('gobject-2.0'),
         dependency('gtk+-3.0',version:'>=3.22'),
+        dependency('granite', version: '>= 6.0.0'),
         dependency('cairo'),
         dependency('json-glib-1.0'),
         dependency('gdk-pixbuf-2.0'),
diff --git a/src/Application.vala b/src/Application.vala
index 777d8ce..501f147 100644
--- a/src/Application.vala
+++ b/src/Application.vala
@@ -82,6 +82,16 @@ public class DesktopFolderApp : Gtk.Application {
      * @description activate life cycle
      */
     protected override void activate () {
+        // elementary OS 6 dark mode support
+        var granite_settings = Granite.Settings.get_default ();
+        var gtk_settings = Gtk.Settings.get_default ();
+
+        gtk_settings.gtk_application_prefer_dark_theme = granite_settings.prefers_color_scheme == Granite.Settings.ColorScheme.DARK;
+
+        granite_settings.notify["prefers-color-scheme"].connect (() => {
+            gtk_settings.gtk_application_prefer_dark_theme = granite_settings.prefers_color_scheme == Granite.Settings.ColorScheme.DARK;
+        });
+
         base.activate ();
         debug ("activate event");
         this.hold ();
-- 
2.24.3 (Apple Git-128)
